{"version":3,"file":"static/js/reviewphoto.61dec05a.chunk.js","mappings":"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","sources":["api/apis.ts","api/index.ts","hooks/index.ts","webpack://react-mind-map/./src/pages/ReviewPhoto/index.module.less?d137","pages/ReviewPhoto/index.tsx"],"sourcesContent":["import { getApi, posApi } from '.';\n\nexport const doLogin = (data) => {\n  return posApi('/user/doLogin', { ...data });\n};\n\nexport const register = (data) => {\n  return posApi('/user/register', { ...data });\n};\n\nexport const getCaptcha = (data) => {\n  return getApi('/user/getCaptcha', { ...data });\n};\n\nexport const isLogin = () => {\n  return getApi('/user/isLogin', {});\n};\n\nexport const uploadPic = (data: any) => {\n  return posApi('/file/upload', data);\n};\n\nexport const getFilePic = (data: any) => {\n  return getApi('/file/getFile', data);\n};\n","import { useConfigToken } from '@/store/login';\nimport axios from 'axios';\n\nexport const isSuccess = (code) => {\n  return ['200', 200].includes(code);\n};\n\nexport const isUnLogin = (code) => {\n  return ['100005', 100005].includes(code);\n};\n\nexport const updateUrl = '';\n\nconst instance = axios.create({\n  baseURL: 'http://47.121.126.205:8099/file-api/v1', //'http://www.shantu.top:8099/file-api/v1', // //'https://some-domain.com/api/',\n  // baseURL: 'http://www.shantu.top/file-api/v1',\n  timeout: 7000,\n  headers: {\n    'Content-Type': 'application/json;charset=utf-8',\n  },\n  // `withCredentials` 表示跨域请求时是否需要使用凭证\n  withCredentials: false, // default\n});\n// 添加请求拦截器\ninstance.interceptors.request.use(\n  function (config) {\n    // 在发送请求之前做些什么\n    return config;\n  },\n  function (error) {\n    // 对请求错误做些什么\n    return Promise.reject(error);\n  },\n);\n\n// 添加响应拦截器\ninstance.interceptors.response.use(\n  function (response) {\n    // 对响应数据做点什么\n    return response;\n  },\n  function (error) {\n    // 对响应错误做点什么\n    return Promise.reject({\n      code: error.response.data.status,\n      data: error.response.data.error || '网络错误，请稍后重试',\n    });\n  },\n);\n\nexport const posApi = (url: string, data?: any): Promise<any> => {\n  return new Promise((resolve, reject) => {\n    const { getToken } = useConfigToken();\n    const token = getToken();\n    const axiosOptions = {\n      url: url,\n      method: 'post',\n      data: Object.assign({ ...data }),\n      headers: {\n        token,\n      },\n    };\n    instance\n      .request(axiosOptions)\n      .then((data) => {\n        resolve(data.data);\n      })\n      .catch((e) => {\n        reject(e.message);\n      });\n  });\n};\n\nexport const getApi = (url: string, data?: any): Promise<any> => {\n  // 与业务无关的异常将在这里处理\n  return new Promise((resolve, reject) => {\n    const { getToken } = useConfigToken();\n    const token = getToken();\n    const axiosOptions = {\n      url: url,\n      method: 'get',\n      params: data,\n      headers: {\n        token,\n      },\n    };\n    instance\n      .request(axiosOptions)\n      .then((data) => {\n        resolve(data.data);\n      })\n      .catch((e) => {\n        reject(e.message);\n      });\n  });\n};\n","import { useLocation } from 'react-router-dom';\n\nfunction useUrlParams() {\n  const location = useLocation();\n  const params = new URLSearchParams(location.search);\n\n  const paramsObject = {};\n  params.forEach((value, key) => {\n    paramsObject[key] = value;\n  });\n\n  return paramsObject;\n}\n\nexport { useUrlParams };\n","// extracted by mini-css-extract-plugin\nexport default {\"repvePhotoWarp\":\"index_repvePhotoWarp__npMLo\",\"timeTips\":\"index_timeTips__asPNH\",\"myCanvasWarp\":\"index_myCanvasWarp__M79Ro\",\"myCanvas\":\"index_myCanvas__6uvR8\"};","/* eslint-disable react-hooks/exhaustive-deps */\nimport { memo, useEffect, useRef, useState } from 'react';\nimport styles from './index.module.less';\n\n// import base64 from './test';\nimport { getFilePic } from '@/api/apis';\nimport { useUrlParams } from '@/hooks';\nimport { useNavigate } from 'react-router';\nimport { isSuccess, isUnLogin } from '@/api';\nimport { message } from 'antd';\n\nconst hadSeeTxt = '图片已查看且销毁';\nconst unSeeTxt = '长按查看图片';\nconst errTxt = '错误的地址，请重新索取分享连接';\n\nconst ReviewPhoto = () => {\n  const refs = useRef(null);\n  const base64Ref = useRef(null);\n  const navigate = useNavigate();\n\n  const [base64Src, setBase64Src] = useState('');\n  const [text, setText] = useState('');\n  const [timeNum, setTimeNum] = useState(3); // 时间大于0秒 ，还可以查看\n\n  const timerRef = useRef(null);\n  const [startTimeEnd, setStartTimeEnd] = useState(undefined); // 是否开始倒计时  undefined 标识初始化\n\n  const urlInfo: any = useUrlParams();\n\n  // 请求图片 判断是否看过图片\n  useEffect(() => {\n    if (urlInfo && urlInfo.fileId) {\n      getFilePic({ fileId: urlInfo.fileId }).then((res) => {\n        // 成功了，则设置图片\n        if (isSuccess(res.code)) {\n          base64Ref.current = res.data;\n          setText(unSeeTxt);\n        }\n        // 没登陆，则跳转到登陆页【带着登陆后回跳的参数】\n        else if (isUnLogin(res.code)) {\n          message.error({\n            content: res?.description || '登录超时，请重新登录',\n          });\n          setTimeout(() => {\n            const from = window.location.href;\n            const url = `/login?from=${from}`;\n            navigate(url);\n          }, 2000);\n        }\n        // 其它则展示 图片已经销毁\n        else {\n          setText(hadSeeTxt);\n          setTimeout(() => {\n            navigate(`/`);\n          }, 2000);\n        }\n      });\n    }\n    // 没有 fileId 则跳首页  说明参数不全\n    else {\n      setText(errTxt);\n      setTimeout(() => {\n        navigate(`/`);\n      }, 2000);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // 销毁图片   查看过\n  const destroyImg = () => {\n    setText('图片已查看且销毁');\n    setBase64Src('');\n    setStartTimeEnd(false);\n    base64Ref.current = null;\n\n    timerRef.current && clearTimeout(timerRef.current); // 倒计时没结束，就抬起鼠标了\n    // console.log('发个接口销毁一下图片');\n\n    setTimeout(() => {\n      navigate(`/`);\n    }, 2000);\n  };\n\n  // 倒计时\n  useEffect(() => {\n    if (startTimeEnd === undefined) {\n      // console.log('进入effect --- 初始化', timeNum);\n      return;\n    }\n    // console.log('进入effect', timeNum);\n\n    // 开始倒计时\n    if (startTimeEnd) {\n      if (timeNum <= 0) {\n        destroyImg();\n        return;\n      }\n\n      timerRef.current = setTimeout(() => {\n        setTimeNum(timeNum - 1);\n      }, 1000);\n    } else {\n      destroyImg();\n    }\n\n    return () => {\n      // console.log('销毁');\n      timerRef.current && clearTimeout(timerRef.current);\n    };\n  }, [startTimeEnd, timeNum]);\n\n  // 事件\n  useEffect(() => {\n    refs.current.addEventListener('contextmenu', function (e) {\n      e.preventDefault();\n    });\n\n    refs.current.addEventListener('touchstart', function (e) {\n      if (base64Ref.current) {\n        // console.log('touchstart');\n        setStartTimeEnd(true);\n        setText('');\n        setBase64Src(base64Ref.current);\n      }\n\n      e.preventDefault();\n    });\n\n    // 手指抬起，设置永远无法查看第2次\n    refs.current.addEventListener('touchend', function (e) {\n      if (base64Ref.current) {\n        // console.log('touchend');\n        setStartTimeEnd(false);\n      }\n      e.preventDefault();\n    });\n  }, []);\n\n  return (\n    <div className={styles.repvePhotoWarp} ref={refs}>\n      {startTimeEnd ? <span className={styles.timeTips}>{timeNum}</span> : null}\n      <span className={styles.text}>{text}</span>\n      {startTimeEnd ? (\n        <div className={styles.myCanvasWarp}>\n          <img className={styles.myCanvas} src={base64Src} alt=\"\" />\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nexport default memo(ReviewPhoto);\n\n// {/* <canvas\n//       width={'100%'}\n//       height={'100%'}\n//       ref={canvasRef}\n//       id=\"myCanvas\"\n//       className={styles.myCanvas}\n//     ></canvas> */}\n\n// useEffect(() => {\n//   setTimeout(() => {\n//     let canvas: any = canvasRef.current; //document.getElementById('myCanvas');\n\n//     let w = canvas.width;\n//     let h = canvas.height;\n//     debugger;\n//     if (canvas.getContext) {\n//       let ctx = canvas.getContext('2d');\n//       let img: any = new Image();\n//       img.src = base64; // 'https://gtms02.alicdn.com/tps/i2/TB1ZeJGIXXXXXcnXXXXDgwcQVXX-375-130.jpg'; // 图片地址示例\n//       img.onload = function () {\n//         let iw = this.width;\n//         let ih = this.height;\n//         debugger;\n//         // let local = calculate(iw, ih);\n//         ctx.fillStyle = '#000';\n//         ctx.fill();\n//         ctx.drawImage(this, 0, 0);\n//         // ctx.drawImage(this, local.px, local.py, local.pw, local.ph);\n//       };\n//     }\n\n//     // 计算出图片画在canvas中的四个参数\n//     function calculate(pw, ph) {\n//       let px = 0;\n//       let py = 0;\n//       if (pw < w && ph < h) {\n//         px = 0.5 * w - 0.5 * pw;\n//         py = 0.5 * h - 0.5 * ph;\n//       } else if (ph / pw > h / w) {\n//         let uu = ph;\n//         ph = h;\n//         pw = (pw * h) / uu;\n//         px = 0.5 * w - 0.5 * pw;\n//       } else {\n//         let uu = pw;\n//         pw = w;\n//         ph = (ph * pw) / uu;\n//         py = 0.5 * h - 0.5 * ph;\n//       }\n//       return { px, py, pw, ph };\n//     }\n//   }, 1000);\n// }, []);\n"],"names":["doLogin","data","posApi","register","getCaptcha","getApi","uploadPic","getFilePic","isSuccess","code","includes","isUnLogin","updateUrl","instance","axios","create","baseURL","timeout","headers","withCredentials","interceptors","request","use","config","error","Promise","reject","response","status","url","resolve","getToken","useConfigToken","token","axiosOptions","method","Object","assign","then","catch","e","message","params","useUrlParams","location","useLocation","URLSearchParams","search","paramsObject","forEach","value","key","ReviewPhoto","refs","useRef","base64Ref","navigate","useNavigate","base64Src","setBase64Src","useState","text","setText","timeNum","setTimeNum","timerRef","startTimeEnd","setStartTimeEnd","undefined","urlInfo","useEffect","fileId","res","current","_message","content","description","setTimeout","from","window","href","destroyImg","clearTimeout","addEventListener","preventDefault","_jsxs","className","styles","repvePhotoWarp","ref","children","_jsx","timeTips","myCanvasWarp","myCanvas","src","alt","memo"],"sourceRoot":""}